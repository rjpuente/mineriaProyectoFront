{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport firebase from \"../../database/firebase\";\nimport { useNotificationContext } from \"./NotificationContext\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext();\nexport function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isLoading = _useState2[0],\n    setIsLoading = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    userToken = _useState4[0],\n    setUserToken = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    userData = _useState6[0],\n    setUserData = _useState6[1];\n  var login = function () {\n    var _ref3 = _asyncToGenerator(function* (_ref2) {\n      var username = _ref2.username,\n        password = _ref2.password;\n      setIsLoading(true);\n      try {\n        var querySnapshot = yield firebase.db.collection('users').where('username', '==', username).where('password', '==', password).get();\n        if (!querySnapshot.empty) {\n          var userSnapshot = querySnapshot.docs[0];\n          setUserData(userSnapshot.data());\n          console.log(userSnapshot.data());\n          AsyncStorage.setItem('userInfo', JSON.stringify(userInfo));\n        } else {\n          console.log('Usuario no encontrado');\n        }\n      } catch (error) {} finally {\n        setIsLoading(false);\n      }\n    });\n    return function login(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref4 = _asyncToGenerator(function* () {\n      setUserToken(null);\n      yield AsyncStorage.removeItem('userToken');\n    });\n    return function logout() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var restoreToken = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      var token = yield AsyncStorage.getItem('userToken');\n      setUserToken(token);\n    });\n    return function restoreToken() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var isLoggedIn = function () {\n    var _ref6 = _asyncToGenerator(function* () {\n      try {\n        setIsLoading(true);\n        var _userToken = yield AsyncStorage.getItem('userToken');\n        var _userInfo = yield AsyncStorage.getItem('userInfo');\n        var userInfoData = JSON.parse(_userInfo);\n        if (userInfoData) {\n          setUserToken(_userToken);\n          setUserData(userInfoData);\n        }\n      } catch (error) {\n        console.log('isLoggedIn error: ', error);\n      } finally {\n        setIsLoading(false);\n      }\n    });\n    return function isLoggedIn() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n  var register = function () {\n    var _ref8 = _asyncToGenerator(function* (_ref7) {\n      var username = _ref7.username,\n        password = _ref7.password,\n        email = _ref7.email;\n      setIsLoading(true);\n      try {\n        yield firebase.db.collection('users').add({\n          username: username,\n          password: password,\n          email: email\n        });\n        var data = yield request.data;\n        console.log(data);\n        setNotification({\n          message: 'Usuario registrado',\n          level: 'success'\n        });\n      } catch (error) {} finally {\n        setIsLoading(false);\n      }\n    });\n    return function register(_x2) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    restoreToken();\n  }, []);\n  return _jsx(AuthContext.Provider, {\n    value: {\n      userToken: userToken,\n      login: login,\n      logout: logout,\n      register: register\n    },\n    children: children\n  });\n}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","AsyncStorage","firebase","useNotificationContext","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","isLoading","setIsLoading","_useState3","_useState4","userToken","setUserToken","_useState5","_useState6","userData","setUserData","login","_ref3","_asyncToGenerator","_ref2","username","password","querySnapshot","db","collection","where","get","empty","userSnapshot","docs","data","console","log","setItem","JSON","stringify","userInfo","error","_x","apply","arguments","logout","_ref4","removeItem","restoreToken","_ref5","token","getItem","isLoggedIn","_ref6","userInfoData","parse","register","_ref8","_ref7","email","add","request","setNotification","message","level","_x2","Provider","value"],"sources":["C:/xampp/htdocs/mineriaProyectoFront/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport firebase from '../../database/firebase'\r\nimport { useNotificationContext } from './NotificationContext'\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [userToken, setUserToken] = useState(null)\r\n  const [userData, setUserData] = useState(null)\r\n  /* const { setNotification } = useNotificationContext() */\r\n\r\n  const login = async ({ username, password }) => {\r\n    setIsLoading(true)\r\n\r\n    try {\r\n      const querySnapshot = await firebase.db\r\n        .collection('users')\r\n        .where('username', '==', username)\r\n        .where('password', '==', password)\r\n        .get();\r\n\r\n      /* const userInfo = await request.data\r\n\r\n      const { token } = userInfo\r\n\r\n      setUserToken(token) */\r\n      \r\n      if (!querySnapshot.empty) {\r\n        const userSnapshot = querySnapshot.docs[0];\r\n        setUserData(userSnapshot.data())\r\n        console.log(userSnapshot.data());\r\n        AsyncStorage.setItem('userInfo', JSON.stringify(userInfo))\r\n\r\n      } else {\r\n        console.log('Usuario no encontrado');\r\n      }\r\n      /* AsyncStorage.setItem('userToken', token) */\r\n    } catch (error) {\r\n      /* if (error.response.status === 401) {\r\n        setNotification({\r\n          message: 'Credenciales incorrectas',\r\n          level: 'error'\r\n        })\r\n      } else {\r\n        setNotification({\r\n          message: 'Error al iniciar la sesiÃ³n',\r\n          level: 'error'\r\n        })\r\n      } */\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const logout = async () => {\r\n    setUserToken(null);\r\n    await AsyncStorage.removeItem('userToken');\r\n  };\r\n\r\n  const restoreToken = async () => {\r\n    const token = await AsyncStorage.getItem('userToken');\r\n    setUserToken(token);\r\n  };\r\n\r\n  const isLoggedIn = async () => {\r\n    try {\r\n      setIsLoading(true)\r\n      const userToken = await AsyncStorage.getItem('userToken')\r\n      const userInfo = await AsyncStorage.getItem('userInfo')\r\n      const userInfoData = JSON.parse(userInfo)\r\n\r\n      if (userInfoData) {\r\n        setUserToken(userToken)\r\n        setUserData(userInfoData)\r\n      }\r\n    } catch (error) {\r\n      console.log('isLoggedIn error: ', error)\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  const register = async ({ username, password, email }) => {\r\n    setIsLoading(true)\r\n\r\n    try {\r\n      await firebase.db.collection('users').add({\r\n        username: username,\r\n        password: password,\r\n        email: email\r\n      })\r\n\r\n      const data = await request.data\r\n\r\n      console.log(data)\r\n      setNotification({\r\n        message: 'Usuario registrado',\r\n        level: 'success'\r\n      })\r\n    } catch (error) {\r\n      /* if (error.response.status === 400) {\r\n        setNotification({\r\n          message: 'Usuario ya registrado',\r\n          level: 'error'\r\n        })\r\n      } else {\r\n        setNotification({\r\n          message: 'Error al registrar el usuario',\r\n          level: 'error'\r\n        })\r\n      } */\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    restoreToken();\r\n  }, []);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ userToken, login, logout, register }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}